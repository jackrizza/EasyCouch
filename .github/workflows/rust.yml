name: Cargo Tests

on:
  push:
    branches: ["main"]
  pull_request:
    branches: ["main"]

env:
  CARGO_TERM_COLOR: always

jobs:
  build:
    runs-on: ubuntu-latest

    steps:
      - name: add couchdb key
        run: curl -L https://couchdb.apache.org/repo/bintray-pubkey.asc | sudo apt-key add -
      - name: update
        run: sudo apt update
      - name: Install dependencies
        run: sudo apt install -y couchdb
      - name: env file
        run: echo "USERNAME=admin\nPASSWORD\nURL=http://localhost:5984" > .env
      - uses: actions/checkout@v4
      - name: Build
        run: cargo build --verbose
      - name: Run tests
        run: cargo test --verbose
